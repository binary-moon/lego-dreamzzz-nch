var xrcontroller=pc.createScript("xrcontroller");xrcontroller.attributes.add("disableWorldTracking",{type:"boolean"}),xrcontroller.attributes.add("shadowmaterial",{type:"asset"}),xrcontroller.prototype.initialize=function(){this.disableWorldTracking;this.shadowmaterial&&this.makeShadowMaterial({pc:pc,material:this.shadowmaterial});const a=XRExtras.PlayCanvas.findOneCamera(this.entity);XRExtras.Loading.showLoading({onxrloaded:(({pcCamera:a,pcApp:e},t)=>()=>{const r={canvas:document.getElementById("application-canvas"),verbose:!0};XR8.PlayCanvas.runXr({pcCamera:a,pcApp:e},t,r)})({pcCamera:a,pcApp:this.app},[LandingPage.pipelineModule(),XRExtras.Loading.pipelineModule(),XRExtras.RuntimeError.pipelineModule(),CoachingOverlay.pipelineModule(),{loadAnimation:"none",name:"trackingstate",listeners:[{event:"reality.trackingstatus",process:({detail:a})=>window.dispatchEvent(new CustomEvent("xrtrackingstatus",{detail:{status:a.status,reason:a.reason}}))}]}]),loadBackgroundColor:"#007AFF",cameraBackgroundColor:"#5AC8FA"})},xrcontroller.prototype.makeShadowMaterial=function({pc:a,material:e}){const t=e.resource||e;t.chunks.APIVersion=a.CHUNKAPI_1_65,t.chunks.endPS="\n      litArgs_opacity = mix(light0_shadowIntensity, 0.0, shadow0);\n      gl_FragColor.rgb = vec3(0.0);\n    ",t.blendType=a.BLEND_PREMULTIPLIED,t.update()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var taprecenter=pc.createScript("taprecenter");taprecenter.prototype.initialize=function(){this.app.touch.on(pc.EVENT_TOUCHSTART,(e=>{1===e.touches.length&&this.app.fire("xr:recenter")}))};var placemodel=pc.createScript("placemodel");placemodel.prototype.initialize=function(){const t=this.entity;window.addEventListener("xrtrackingstatus",(({detail:e})=>{"LIMITED"===e.status&&"INITIALIZING"===e.reason&&t.setLocalScale(.001,.001,.001),"NORMAL"===e.status&&t.setLocalScale(1,1,1)}))};var RandomPlayerController=pc.createScript("randomPlayerController");RandomPlayerController.attributes.add("maxHitPoints",{type:"number",default:5,title:"Max Hit Points"}),RandomPlayerController.attributes.add("healthBarEntity",{type:"entity",title:"Health Bar Entity"}),RandomPlayerController.attributes.add("flashColor",{type:"rgb",default:[1,1,1],title:"Flash Color"}),RandomPlayerController.prototype.initialize=function(){this.bounds={xMin:-2,xMax:2,zMin:-2,zMax:2},this.speed=2,this.evadeSpeed=4,this.minDistance=.3,this.maxDistance=2,this.currentDirection=null,this.chooseRandomDirection(),this.changeDirectionInterval=setInterval(this.chooseRandomDirection.bind(this),1e3),this.renderers=[],this.materials=[],this.entity.findComponents("render").forEach(function(t){if(this.renderers.push(t),Array.isArray(t.materials))t.materials.forEach(function(i){this.materials.push({renderer:t,material:i,originalEmissive:i.emissive.clone()})}.bind(this));else{var i=t.material;this.materials.push({renderer:t,material:i,originalEmissive:i.emissive.clone()})}}.bind(this)),console.log("Total materials found:",this.materials.length),this.flashDuration=.1,this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.app.on("target:player",this.onTargetPlayer,this),this.isEvading=!1,this.hitPoints=this.maxHitPoints,this.healthBarEntity&&(this.healthBar=this.healthBarEntity.script.healthBar,this.healthBar.setProgress(1)),this.previousEvadeDirection=null,this.evadeCooldown=.5,this.lastEvadeTime=-this.evadeCooldown,this.on("state",this.onStateChanged,this)},RandomPlayerController.prototype.onCollisionStart=function(t){t.other.rigidbody&&t.other.tags&&t.other.tags.has("Laser")&&(this.onHitPlayer(),t.other.enabled=!1)},RandomPlayerController.prototype.update=function(t){var i=0,e=0;if(this.isEvading)this.moveTowards(this.evadeTargetPosition,t,this.evadeSpeed),i=this.evadeDirection.x,e=this.evadeDirection.z;else if(this.currentDirection){var a=this.getRandomDistance()*this.speed*t,s=this.entity.getPosition().clone();switch(this.currentDirection){case"left":s.x-=a,i=-1;break;case"right":s.x+=a,i=1;break;case"forward":s.z+=a,e=1;break;case"back":s.z-=a,e=-1}s.x=pc.math.clamp(s.x,this.bounds.xMin,this.bounds.xMax),s.z=pc.math.clamp(s.z,this.bounds.zMin,this.bounds.zMax),this.entity.setPosition(s)}this.entity.anim.setFloat("xDirection",i),this.entity.anim.setFloat("zDirection",e)},RandomPlayerController.prototype.chooseRandomDirection=function(){var t=[],i=this.entity.getPosition();i.x>this.bounds.xMin+this.minDistance&&t.push("left"),i.x<this.bounds.xMax-this.minDistance&&t.push("right"),i.z<this.bounds.zMax-this.minDistance&&t.push("forward"),i.z>this.bounds.zMin+this.minDistance&&t.push("back"),t.length>0&&(this.currentDirection=t[Math.floor(Math.random()*t.length)])},RandomPlayerController.prototype.getRandomDistance=function(){return Math.max(this.minDistance,Math.random()*this.maxDistance)},RandomPlayerController.prototype.onHitPlayer=function(){this.flashPlayer(),this.hitPoints--,this.updateHealthBar(),this.hitPoints<=0&&(this.hitPoints=0,this.app.fire("player:defeated"))},RandomPlayerController.prototype.onTargetPlayer=function(){var t=Date.now()/1e3;!this.isEvading&&t-this.lastEvadeTime>=this.evadeCooldown&&(this.evadeMovement(),this.lastEvadeTime=t)},RandomPlayerController.prototype.flashPlayer=function(){var t=this,i=this.flashColor;this.materials.forEach((function(t){t.material.emissive.copy(i),t.material.update()})),setTimeout((function(){t.materials.forEach((function(t){t.material.emissive.copy(t.originalEmissive),t.material.update()}))}),1e3*this.flashDuration)},RandomPlayerController.prototype.evadeMovement=function(){var t=[],i=this.entity.getPosition();if(i.x>this.bounds.xMin+1&&"left"!==this.previousEvadeDirection&&t.push("left"),i.x<this.bounds.xMax-1&&"right"!==this.previousEvadeDirection&&t.push("right"),i.z>this.bounds.zMin+1&&"back"!==this.previousEvadeDirection&&t.push("back"),t.length>0){var e=t[Math.floor(Math.random()*t.length)];switch(this.evadeTargetPosition=i.clone(),this.evadeDirection=new pc.Vec2(0,0),e){case"left":this.evadeTargetPosition.x-=1,this.evadeDirection.x=-1;break;case"right":this.evadeTargetPosition.x+=1,this.evadeDirection.x=1;break;case"back":this.evadeTargetPosition.z-=1,this.evadeDirection.z=-1}this.evadeTargetPosition.x=pc.math.clamp(this.evadeTargetPosition.x,this.bounds.xMin,this.bounds.xMax),this.evadeTargetPosition.z=pc.math.clamp(this.evadeTargetPosition.z,this.bounds.zMin,this.bounds.zMax),this.previousEvadeDirection=e,this.isEvading=!0}},RandomPlayerController.prototype.moveTowards=function(t,i,e){var a=this.entity.getPosition(),s=e*i,o=t.clone().sub(a).normalize().scale(s),n=a.clone().add(o);n.distance(t)<=s&&(n=t,this.isEvading=!1),this.entity.setPosition(n)},RandomPlayerController.prototype.updateHealthBar=function(){if(this.healthBar){var t=this.hitPoints/this.maxHitPoints;this.healthBar.setProgress(t)}},RandomPlayerController.prototype.onStateChanged=function(t){1==t&&this.resetPlayer()},RandomPlayerController.prototype.resetPlayer=function(){this.entity.setPosition(0,0,0),this.hitPoints=this.maxHitPoints,this.healthBar&&this.healthBar.setProgress(1),this.materials.forEach(function(t){t.material.emissive.copy(t.originalEmissive),t.material.update()}.bind(this)),this.chooseRandomDirection(),this.isEvading=!1,this.previousEvadeDirection=null,this.lastEvadeTime=-this.evadeCooldown,this.entity.anim.setFloat("xDirection",0),this.entity.anim.setFloat("zDirection",0)};var RaycastFromCamera=pc.createScript("raycastFromCamera");RaycastFromCamera.attributes.add("reticle",{type:"entity",title:"Reticle"}),RaycastFromCamera.attributes.add("flutterSpeed",{type:"number",default:1,title:"Flutter Speed"}),RaycastFromCamera.attributes.add("progressBar",{type:"entity",title:"Progress Bar"}),RaycastFromCamera.attributes.add("defaultReticleBackgroundColor",{type:"rgba",default:[1,1,1,1],title:"Default Reticle Background Color"}),RaycastFromCamera.attributes.add("defaultReticleColor",{type:"rgba",default:[1,1,1,1],title:"Default Reticle Color"}),RaycastFromCamera.attributes.add("highlightedReticleColor",{type:"rgba",default:[1,0,0,1],title:"Highlighted Reticle Color"}),RaycastFromCamera.attributes.add("reticleBackground",{type:"entity",title:"Reticle Background"}),RaycastFromCamera.attributes.add("projectilePrefab",{type:"entity",title:"Projectile Prefab"}),RaycastFromCamera.attributes.add("projectileSpeed",{type:"number",default:20,title:"Projectile Speed"}),RaycastFromCamera.attributes.add("gunFront",{type:"entity",title:"Gun Front"}),RaycastFromCamera.attributes.add("blaster",{type:"entity",title:"Blaster"}),RaycastFromCamera.attributes.add("swaySpeed",{type:"number",default:.5,title:"Sway Speed"}),RaycastFromCamera.attributes.add("swayAmplitude",{type:"number",default:.1,title:"Sway Amplitude"}),RaycastFromCamera.prototype.initialize=function(){this.camera=this.entity,this.reticle&&this.reticle.element?this.reticleImage=this.reticle.element:console.error("Reticle entity or element not found"),this.progressBarScript=this.progressBar.script.progressBar,this.progressBarScript||console.error("ProgressBar script not found"),this.reticleBackground&&this.reticleBackground.element?this.reticleBackgroundImage=this.reticleBackground.element:console.error("Reticle background entity not assigned"),this.reticlePosition=new pc.Vec2(this.app.graphicsDevice.width/2,this.app.graphicsDevice.height/2),this.flutterBoxSize=60,this.timeX=1e3*Math.random(),this.timeY=1e3*Math.random(),this.reticleBackgroundPosition=new pc.Vec2(this.reticlePosition.x,this.reticlePosition.y),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onShoot,this),this.app.touch.on(pc.EVENT_TOUCHSTART,this.onShoot,this),this.reticleEnabled=!0,this.app.on("reticle:disable",this.disableReticle,this),this.app.on("reticle:enable",this.enableReticle,this),this.app.on("progress:complete",this.recticleReset,this),this.projectilePool=[];for(var t=0;t<10;t++){var e=this.projectilePrefab.clone();this.app.root.addChild(e),e.enabled=!1,e.rigidbody.teleport(0,0,0),e.rigidbody.linearVelocity=pc.Vec3.ZERO,e.rigidbody.angularVelocity=pc.Vec3.ZERO,this.projectilePool.push(e)}this.swayTime=0,this.initialBlasterPosition=this.blaster.getLocalPosition().clone()},RaycastFromCamera.prototype.recticleReset=function(){this.reticle.element.opacity=1},RaycastFromCamera.prototype.update=function(t){if(this.reticleImage&&this.reticleEnabled){this.timeX+=t*this.flutterSpeed,this.timeY+=t*this.flutterSpeed;var e=2*(noise.perlin2(this.timeX,0)-.5)*this.flutterBoxSize,i=2*(noise.perlin2(this.timeY,0)-.5)*this.flutterBoxSize,a=this.app.graphicsDevice.maxPixelRatio;this.reticlePosition.x=(this.app.graphicsDevice.width/2+e)/a,this.reticlePosition.y=(this.app.graphicsDevice.height/2+i)/a;this.reticleBackgroundPosition.lerp(this.reticleBackgroundPosition,this.reticlePosition,.1);var r=this.gunFront.getPosition(),s=r.clone().add(this.gunFront.forward.clone().scale(this.entity.camera.farClip)),o=this.app.systems.rigidbody.raycastFirst(r,s);o&&o.entity.tags&&o.entity.tags.has("npc")?(this.app.fire("target:player"),this.reticleImage.color=this.highlightedReticleColor,this.isAimingAtWitch=!0):(this.reticleImage.color=this.defaultReticleColor,this.isAimingAtWitch=!1),this.reticle.setLocalPosition(e,i,0),this.reticleBackground.setLocalPosition((this.reticleBackgroundPosition.x-this.app.graphicsDevice.width/2)/a,(this.reticleBackgroundPosition.y-this.app.graphicsDevice.height/2)/a,0),this.swayTime+=t*this.swaySpeed;var l=Math.sin(this.swayTime)*this.swayAmplitude,c=Math.cos(this.swayTime)*this.swayAmplitude,h=this.initialBlasterPosition.clone().add(new pc.Vec3(l,c,0));this.blaster.setLocalPosition(h)}},RaycastFromCamera.prototype.onShoot=function(t){this.reticleImage&&this.reticleEnabled&&this.progressBarScript.progress>=1&&(this.reticle.element.opacity=.5,this.app.fire("blaster:shoot"),this.shootProjectile(),this.progressBarScript.resetProgress(),setTimeout((()=>{this.app.fire("laser:charge")}),200))},RaycastFromCamera.prototype.shootProjectile=function(){for(var t=null,e=0;e<this.projectilePool.length;e++)if(!this.projectilePool[e].enabled){t=this.projectilePool[e];break}t||(t=this.projectilePrefab.clone(),this.app.root.addChild(t),this.projectilePool.push(t));var i=this.gunFront.getPosition(),a=this.gunFront.forward,r=i.clone().add(a.clone().scale(.3));t.setPosition(r),t.setRotation(this.gunFront.getRotation()),t.enabled=!0,t.rigidbody.linearVelocity=pc.Vec3.ZERO,t.rigidbody.angularVelocity=pc.Vec3.ZERO;var s=a.clone().scale(this.projectileSpeed);t.rigidbody.applyImpulse(s)},RaycastFromCamera.prototype.disableReticle=function(){this.reticle&&(this.reticle.enabled=!1),this.reticleBackground&&(this.reticleBackground.enabled=!1),this.reticleEnabled=!1},RaycastFromCamera.prototype.enableReticle=function(){this.reticle&&(this.reticle.enabled=!0),this.reticleBackground&&(this.reticleBackground.enabled=!0),this.reticleEnabled=!0,this.reticle.element.opacity=1},RaycastFromCamera.prototype.destroy=function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onShoot,this),this.app.touch.off(pc.EVENT_TOUCHSTART,this.onShoot,this),this.app.off("reticle:disable",this.disableReticle,this),this.app.off("reticle:enable",this.enableReticle,this)};var PostMessage=pc.createScript("postMessage");PostMessage.attributes.add("action",{type:"string",default:"exitAR",title:"Action"}),PostMessage.prototype.initialize=function(){this.entity.element.on("click",(function(){this.sendExitMessage()}),this)},PostMessage.prototype.sendExitMessage=function(){window.parent&&window.parent.postMessage({action:this.action},"*")};!function(r){var t=r.noise={};function Grad(r,t,o){this.x=r,this.y=t,this.z=o}Grad.prototype.dot2=function(r,t){return this.x*r+this.y*t},Grad.prototype.dot3=function(r,t,o){return this.x*r+this.y*t+this.z*o};var o=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],a=new Array(512),n=new Array(512);t.seed=function(r){r>0&&r<1&&(r*=65536),(r=Math.floor(r))<256&&(r|=r<<8);for(var t=0;t<256;t++){var d;d=1&t?e[t]^255&r:e[t]^r>>8&255,a[t]=a[t+256]=d,n[t]=n[t+256]=o[d%12]}},t.seed(0);var d=.5*(Math.sqrt(3)-1),f=(3-Math.sqrt(3))/6,l=1/6;function fade(r){return r*r*r*(r*(6*r-15)+10)}function lerp(r,t,o){return(1-o)*r+o*t}t.simplex2=function(r,t){var o,e,l=(r+t)*d,i=Math.floor(r+l),h=Math.floor(t+l),p=(i+h)*f,u=r-i+p,s=t-h+p;u>s?(o=1,e=0):(o=0,e=1);var G=u-o+f,w=s-e+f,v=u-1+2*f,M=s-1+2*f,c=n[(i&=255)+a[h&=255]],y=n[i+o+a[h+e]],x=n[i+1+a[h+1]],m=.5-u*u-s*s,q=.5-G*G-w*w,z=.5-v*v-M*M;return 70*((m<0?0:(m*=m)*m*c.dot2(u,s))+(q<0?0:(q*=q)*q*y.dot2(G,w))+(z<0?0:(z*=z)*z*x.dot2(v,M)))},t.simplex3=function(r,t,o){var e,d,f,i,h,p,u=.3333333333333333*(r+t+o),s=Math.floor(r+u),G=Math.floor(t+u),w=Math.floor(o+u),v=(s+G+w)*l,M=r-s+v,c=t-G+v,y=o-w+v;M>=c?c>=y?(e=1,d=0,f=0,i=1,h=1,p=0):M>=y?(e=1,d=0,f=0,i=1,h=0,p=1):(e=0,d=0,f=1,i=1,h=0,p=1):c<y?(e=0,d=0,f=1,i=0,h=1,p=1):M<y?(e=0,d=1,f=0,i=0,h=1,p=1):(e=0,d=1,f=0,i=1,h=1,p=0);var x=M-e+l,m=c-d+l,q=y-f+l,z=M-i+2*l,A=c-h+2*l,b=y-p+2*l,g=M-1+.5,j=c-1+.5,k=y-1+.5,B=n[(s&=255)+a[(G&=255)+a[w&=255]]],C=n[s+e+a[G+d+a[w+f]]],D=n[s+i+a[G+h+a[w+p]]],E=n[s+1+a[G+1+a[w+1]]],F=.6-M*M-c*c-y*y,H=.6-x*x-m*m-q*q,I=.6-z*z-A*A-b*b,J=.6-g*g-j*j-k*k;return 32*((F<0?0:(F*=F)*F*B.dot3(M,c,y))+(H<0?0:(H*=H)*H*C.dot3(x,m,q))+(I<0?0:(I*=I)*I*D.dot3(z,A,b))+(J<0?0:(J*=J)*J*E.dot3(g,j,k)))},t.perlin2=function(r,t){var o=Math.floor(r),e=Math.floor(t);r-=o,t-=e;var d=n[(o&=255)+a[e&=255]].dot2(r,t),f=n[o+a[e+1]].dot2(r,t-1),l=n[o+1+a[e]].dot2(r-1,t),i=n[o+1+a[e+1]].dot2(r-1,t-1),h=fade(r);return lerp(lerp(d,l,h),lerp(f,i,h),fade(t))},t.perlin3=function(r,t,o){var e=Math.floor(r),d=Math.floor(t),f=Math.floor(o);r-=e,t-=d,o-=f;var l=n[(e&=255)+a[(d&=255)+a[f&=255]]].dot3(r,t,o),i=n[e+a[d+a[f+1]]].dot3(r,t,o-1),h=n[e+a[d+1+a[f]]].dot3(r,t-1,o),p=n[e+a[d+1+a[f+1]]].dot3(r,t-1,o-1),u=n[e+1+a[d+a[f]]].dot3(r-1,t,o),s=n[e+1+a[d+a[f+1]]].dot3(r-1,t,o-1),G=n[e+1+a[d+1+a[f]]].dot3(r-1,t-1,o),w=n[e+1+a[d+1+a[f+1]]].dot3(r-1,t-1,o-1),v=fade(r),M=fade(t),c=fade(o);return lerp(lerp(lerp(l,u,v),lerp(i,s,v),c),lerp(lerp(h,G,v),lerp(p,w,v),c),M)}}(this);var ProgressBar=pc.createScript("progressBar");ProgressBar.attributes.add("progressImage",{type:"entity"}),ProgressBar.attributes.add("progressImageMaxWidth",{type:"number"}),ProgressBar.attributes.add("fillSpeed",{type:"number",default:1,title:"Fill Speed"}),ProgressBar.prototype.initialize=function(){this.imageRect=this.progressImage.element.rect.clone(),this.setProgress(1),this.filling=!1,this.on("state",this.onStateChanged,this)},ProgressBar.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this.progress=e;var t=pc.math.lerp(0,this.progressImageMaxWidth,e);this.progressImage.element.width=t,this.imageRect.copy(this.progressImage.element.rect),this.imageRect.z=e,this.progressImage.element.rect=this.imageRect},ProgressBar.prototype.resetProgress=function(){this.setProgress(0),this.filling=!0},ProgressBar.prototype.update=function(e){this.filling&&(this.setProgress(this.progress+e*this.fillSpeed),this.progress>=1&&(this.filling=!1,this.app.fire("progress:complete")))},ProgressBar.prototype.onStateChanged=function(e){this.setProgress(1),this.filling=!1};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #000000;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #000000;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://playcanvas.com/static-assets/images/play_text_252_white.png",a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var ProgressRadial=pc.createScript("progressRadial");ProgressRadial.prototype.initialize=function(){this._element=this.entity.element,this._element.material=this._element.material.clone(),this.setProgress(0)},ProgressRadial.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this._progress=e,this._element.material.alphaTest=e+.001};var CountdownTimer=pc.createScript("countdownTimer");CountdownTimer.attributes.add("duration",{type:"number",default:10,title:"Duration",description:"Duration of the countdown in seconds"}),CountdownTimer.attributes.add("textElement",{type:"entity",title:"Text Element",description:"The UI element to display the countdown"}),CountdownTimer.attributes.add("progressRadialEntity",{type:"entity",title:"Progress Radial Entity",description:"The entity with the ProgressRadial script attached"}),CountdownTimer.attributes.add("startEvent",{type:"string",default:"startCountdown",title:"Start Event",description:"The event to start the countdown"}),CountdownTimer.attributes.add("stopEvent",{type:"string",default:"stopCountdown",title:"Stop Event",description:"The event to stop the countdown"}),CountdownTimer.attributes.add("resetEvent",{type:"string",default:"resetCountdown",title:"Reset Event",description:"The event to reset the countdown"}),CountdownTimer.attributes.add("segmentEvent",{type:"string",default:"segmentUpdate",title:"Segment Event",description:"The event to fire every segment"}),CountdownTimer.attributes.add("finalSecondsEvent",{type:"string",default:"finalSeconds",title:"Final Seconds Event",description:"The event to fire every second for the final 10 seconds"}),CountdownTimer.prototype.initialize=function(){this.timeRemaining=this.duration,this.progressRadialScript=this.progressRadialEntity.script.progressRadial,this.setText(Math.floor(this.timeRemaining)),this.segments=36,this.segmentDuration=this.duration/this.segments,this.isRunning=!1,this.hasCompleted=!1,this.previousSegment=-1,this.previousSecond=-1,this.app.on(this.startEvent,this.startCountdown,this),this.app.on(this.stopEvent,this.stopCountdown,this),this.app.on(this.resetEvent,this.resetCountdown,this)},CountdownTimer.prototype.update=function(t){if(this.isRunning&&this.timeRemaining>0){this.timeRemaining-=t,this.setText(Math.ceil(this.timeRemaining));var e=Math.floor((this.duration-this.timeRemaining)/this.segmentDuration),i=e/this.segments;if(this.progressRadialScript.setProgress(i),e!==this.previousSegment&&(this.previousSegment=e,this.app.fire(this.segmentEvent,e)),this.timeRemaining<=10&&Math.ceil(this.timeRemaining)>0){var n=Math.ceil(this.timeRemaining);n!==this.previousSecond&&(this.previousSecond=n,this.app.fire(this.finalSecondsEvent,n))}}else this.timeRemaining<=0&&!this.hasCompleted&&(this.timeRemaining=0,this.setText("0"),this.progressRadialScript.setProgress(1),this.isRunning=!1,this.hasCompleted=!0,this.app.fire("counter:complete"))},CountdownTimer.prototype.setText=function(t){this.textElement&&this.textElement.element&&(this.textElement.element.text=t.toString())},CountdownTimer.prototype.startCountdown=function(){this.timeRemaining=this.duration,this.isRunning=!0,this.hasCompleted=!1,this.previousSegment=-1,this.previousSecond=11},CountdownTimer.prototype.stopCountdown=function(){this.isRunning=!1},CountdownTimer.prototype.resetCountdown=function(){this.timeRemaining=this.duration,this.setText(Math.ceil(this.timeRemaining)),this.progressRadialScript.setProgress(0),this.isRunning=!1,this.hasCompleted=!1,this.previousSegment=-1,this.previousSecond=11};var HealthBar=pc.createScript("healthBar");HealthBar.attributes.add("progressImage",{type:"entity"}),HealthBar.attributes.add("progressImageMaxHeight",{type:"number"}),HealthBar.attributes.add("fillSpeed",{type:"number",default:1,title:"Fill Speed"}),HealthBar.prototype.initialize=function(){this.imageRect=this.progressImage.element.rect.clone(),this.currentProgress=0,this.targetProgress=0,this.setProgress(1),this.app.on("reset:healthbar",this.resetHealthbar,this)},HealthBar.prototype.resetHealthbar=function(){this.setProgress(1)},HealthBar.prototype.setProgress=function(e){e=pc.math.clamp(e,0,1),this.targetProgress=e},HealthBar.prototype.update=function(e){this.currentProgress=pc.math.lerp(this.currentProgress,this.targetProgress,e*this.fillSpeed);var t=pc.math.lerp(0,this.progressImageMaxHeight,this.currentProgress);this.progressImage.element.height=t,this.imageRect.copy(this.progressImage.element.rect),this.imageRect.w=this.currentProgress,this.progressImage.element.rect=this.imageRect},HealthBar.prototype.resetProgress=function(){this.setProgress(0)};var ExperienceManager=pc.createScript("experienceManager");ExperienceManager.attributes.add("Entities",{type:"json",schema:[{name:"radarCreatureText",title:"Radar Creature Name",type:"entity"},{name:"creatureFoundText",title:"Creature Found Text",type:"entity"},{name:"counter",title:"Counter",type:"entity"},{name:"capturedDescriptionWin",title:"Captured Description Win",type:"entity"},{name:"capturedDescriptionLose",title:"Captured Description Lose",type:"entity"}]}),ExperienceManager.attributes.add("Events",{type:"json",schema:[{name:"playerDefeatedEvent",title:"Player Defeated Event",type:"string",default:"player:defeated"}]}),ExperienceManager.attributes.add("settings",{type:"json",schema:[{name:"creatureNames",title:"Creature Names",type:"string",array:!0}]}),ExperienceManager.prototype.initialize=function(){this.currentCharacter=0,this.app.on("player:defeated",this.onPlayerDefeated,this),this.app.on("counter:complete",this.onCounterComplete,this),this.app.on("portal:ended",this.startNewSession,this),this.app.on("homescreen:playPressed",this.newGame,this),this.app.on("challengerScreen:okPressed",this.startNewSearch,this),this.app.on("radarScreen:Found",this.creatureFound,this),this.app.on("endScreen:TryAgain",this.tryAgain,this),this.app.on("endScreen:Finish",this.onFinish,this)},ExperienceManager.prototype.onFinish=function(){this.currentCharacter<this.settings.creatureNames.length-1?(this.currentCharacter++,this.app.fire("radarScreen:reset"),this.app.fire("challengerScreen:setup",this.currentCharacter)):window.parent&&window.parent.postMessage({action:"exitAR"},"*")},ExperienceManager.prototype.tryAgain=function(){this.app.fire("radarScreen:reset"),this.app.fire("challengerScreen:setup",this.currentCharacter)},ExperienceManager.prototype.creatureFound=function(){const e=this.Entities.creatureFoundText,t=this.settings.creatureNames[this.currentCharacter];e&&e.element&&(e.element.text=`CATCH\n${t}\nIN 60 SECONDS`),e.enabled=!0,setTimeout((()=>{this.app.fire("captureIndicator:setScreenParent"),this.startCaptureSequence()}),3e3)},ExperienceManager.prototype.startCaptureSequence=function(){this.app.fire("MenuBackgound:fadeout"),this.app.fire("experienceman:startCapture"),this.app.fire("xr:recenter"),this.app.fire("creatureManager:setupCreature",this.currentCharacter),this.app.fire("startCountdown"),this.app.fire("reticle:enable")},ExperienceManager.prototype.startNewSearch=function(){this.Entities.counter.setLocalScale(1,1,1),this.Entities.counter.setLocalPosition(0,-687.038,0),this.Entities.counter.enabled=!0,this.Entities.creatureFoundText.enabled=!1;const e=this.Entities.radarCreatureText,t=this.settings.creatureNames[this.currentCharacter];e&&e.element&&(e.element.text=`LET'S FIND\n${t}`),e.enabled=!0,this.app.fire("challengerScreen:disable"),this.app.fire("radarScreen:enable"),this.app.fire("captureIndicator:setup",this.currentCharacter),this.app.fire("reset:healthbar"),this.app.fire("resetCountdown")},ExperienceManager.prototype.newGame=function(){this.currentCharacter=0,this.app.fire("experienceman:home:disable"),this.app.fire("challengerScreen:setup",this.currentCharacter)},ExperienceManager.prototype.startNewSession=function(){this.app.fire("MenuBackgound:fadein"),this.app.fire("experienceman:home:enable")},ExperienceManager.prototype.onCounterComplete=function(){const e=this.Entities.capturedDescriptionLose,t=this.settings.creatureNames[this.currentCharacter];e&&e.element&&(e.element.text=`OH NO, ${t}\nGOT AWAY THIS TIME`),this.app.fire("creatureManager:disableCurrentCreature",!1),this.gameOver()},ExperienceManager.prototype.onPlayerDefeated=function(){this.app.fire("captureIndicator:enableCapturedIcon",this.currentCharacter);const e=this.Entities.capturedDescriptionWin,t=this.settings.creatureNames[this.currentCharacter];e&&e.element&&(e.element.text=`AMAZING! YOU CAPTURED\n${t}`),this.app.fire("creatureManager:disableCurrentCreature",!0),this.gameOver()},ExperienceManager.prototype.gameOver=function(){this.app.fire("reticle:disable"),this.app.fire("enableEndScreen"),this.app.fire("MenuBackgound:fadein"),this.app.fire("stopCountdown")},ExperienceManager.prototype.update=function(e){};var UIFade=pc.createScript("UIFade");UIFade.attributes.add("fadeDuration",{type:"number",default:1,title:"Fade Duration (seconds)"}),UIFade.attributes.add("fadeInEvent",{type:"string",default:"fadeIn",title:"Fade In Event"}),UIFade.attributes.add("fadeOutEvent",{type:"string",default:"fadeOut",title:"Fade Out Event"}),UIFade.attributes.add("resetEvent",{type:"string",default:"resetOpacity",title:"Reset Opacity Event"}),UIFade.attributes.add("maxOpacity",{type:"number",default:1,title:"Max Opacity"}),UIFade.attributes.add("minOpacity",{type:"number",default:0,title:"Min Opacity"}),UIFade.prototype.initialize=function(){this.elapsedTime=0,this.isFading=!1,this.targetOpacity=1,this.startOpacity=0,this.originalOpacity=this.entity.element.opacity,this.entity.element.opacity=this.startOpacity,this.app.on(this.fadeInEvent,this.fadeIn,this),this.app.on(this.fadeOutEvent,this.fadeOut,this),this.app.on(this.resetEvent,this.resetOpacity,this)},UIFade.prototype.fadeIn=function(){this.isFading=!0,this.elapsedTime=0,this.startOpacity=this.entity.element.opacity,this.targetOpacity=this.maxOpacity},UIFade.prototype.fadeOut=function(){this.isFading=!0,this.elapsedTime=0,this.startOpacity=this.entity.element.opacity,this.targetOpacity=this.minOpacity},UIFade.prototype.resetOpacity=function(){this.isFading=!0,this.elapsedTime=0,this.startOpacity=this.entity.element.opacity,this.targetOpacity=this.originalOpacity},UIFade.prototype.update=function(t){if(this.isFading){this.elapsedTime+=t;var i=this.elapsedTime/this.fadeDuration;this.entity.element.opacity=pc.math.lerp(this.startOpacity,this.targetOpacity,i),i>=1&&(this.isFading=!1,this.entity.element.opacity=this.targetOpacity)}},UIFade.prototype.destroy=function(){this.app.off(this.fadeInEvent,this.fadeIn,this),this.app.off(this.fadeOutEvent,this.fadeOut,this),this.app.off(this.resetEvent,this.resetOpacity,this)};var EntitySetEnable=pc.createScript("entitySetEnable");EntitySetEnable.attributes.add("Settings",{type:"json",schema:[{name:"ConsoleLogging",title:"Console logging",type:"boolean",default:!1},{name:"ReceiveEvent",title:"Receive Event",type:"string"},{name:"IsLocalEvent",title:"Is Local Event",type:"boolean",default:!1},{name:"EntitiesToEffect",title:"Entities To Effect",type:"entity",array:!0},{name:"Delay",title:"Delay",type:"number",default:0},{name:"EnabledState",title:"Enabled State To Set",type:"string",enum:[{Enable:"Enable"},{Disable:"Disable"},{Toggle:"Toggle"}],default:"Disable"}]}),EntitySetEnable.prototype.initialize=function(){this.Settings.IsLocalEvent?this.entity.on(this.Settings.ReceiveEvent,this.setEntityEnableState,this):this.app.on(this.Settings.ReceiveEvent,this.setEntityEnableState,this)},EntitySetEnable.prototype.setEntityEnableState=function(){var e=this;function setEnableState(e,t){switch(e){case"Enable":t.enabled=!0;break;case"Disable":t.enabled=!1;break;case"Toggle":t.enabled=!t.enabled}}setTimeout((function(){if(e.Settings.EntitiesToEffect.length>0)for(var t=0;t<e.Settings.EntitiesToEffect.length;t++)setEnableState(e.Settings.EnabledState,e.Settings.EntitiesToEffect[t]);else setEnableState(e.Settings.EnabledState,e.entity)}),1e3*this.DelayInSeconds)};var ChallengerScreen=pc.createScript("challengerScreen");ChallengerScreen.attributes.add("entities",{type:"json",schema:[{name:"ChallengerScreen",title:"Challenger Screen",type:"entity"},{name:"CatchText",title:"Catch Text",type:"entity"},{name:"cloudText",title:"Cloud Text",type:"entity",array:!0},{name:"cloudTextElements",title:"Cloud Text Elements",type:"entity",array:!0},{name:"heroCreatureImages",title:"Hero Creature Images",type:"entity",array:!0},{name:"heroCreatureText",title:"Hero Creature Text",type:"entity",array:!0},{name:"heroCreatureEnabledIcon",title:"Hero Creature Enabled Icon",type:"entity",array:!0},{name:"bottomControls",title:"Bottom Controls",type:"entity"},{name:"rockAsset",title:"Rock Asset",type:"entity"}]}),ChallengerScreen.prototype.initialize=function(){this.app.on("challengerScreen:setup",this.SetupChallengerScreen,this)},ChallengerScreen.prototype.SetupChallengerScreen=function(e){this.entities.bottomControls.setLocalPosition(645,-330.124,0),this.entities.CatchText.setLocalPosition(0,216.425,0),this.entities.rockAsset.setLocalPosition(1070.296,-141.542,0);for(var t=0;t<this.entities.heroCreatureText.length;t++)this.entities.heroCreatureText[t].element.opacity=0;for(t=0;t<this.entities.cloudText.length;t++)this.entities.cloudText[t].element.opacity=0;for(t=0;t<this.entities.cloudTextElements.length;t++)this.entities.cloudTextElements[t].element.opacity=0;this.entities.ChallengerScreen.enabled=!0;for(t=0;t<this.entities.cloudText.length;t++)this.entities.cloudText[t].enabled=!1;this.entities.cloudText[e]&&(this.entities.cloudText[e].enabled=!0);for(t=0;t<this.entities.heroCreatureImages.length;t++)this.entities.heroCreatureImages[t].enabled=!1;this.entities.heroCreatureImages[e]&&(this.entities.heroCreatureImages[e].enabled=!0);for(t=0;t<this.entities.heroCreatureText.length;t++)this.entities.heroCreatureText[t].enabled=!1;this.entities.heroCreatureText[e]&&(this.entities.heroCreatureText[e].enabled=!0);for(t=0;t<this.entities.heroCreatureEnabledIcon.length;t++){var i=this.entities.heroCreatureEnabledIcon[t].script.toggleEntities;i.toggleEntities(!1),i&&(t<e?i.toggleEntities(!1):i.toggleEntities(!0))}e===this.entities.cloudText.length-1?this.entities.CatchText.element.text="FINAL CATCH:":this.entities.CatchText.element.text="CATCH:",this.app.fire("challenge:bottomControls"),this.app.fire("challenge:topCaughtText"),this.app.fire("challenge:rockIsland"),this.app.fire("creatureTextFadeIn"),this.app.fire("cloudFade")};var Button2devent=pc.createScript("button2devent");Button2devent.attributes.add("Settings",{type:"json",schema:[{name:"ConsoleLogging",title:"Console logging",type:"boolean",default:!1},{name:"AlertLogging",title:"Alert logging",type:"boolean",default:!1},{name:"FireEvent",title:"Fire Event",type:"string"},{name:"IsLocalEvent",title:"Is Local Event",type:"boolean",default:!1}]}),Button2devent.prototype.initialize=function(){this.entity.button.on("click",(function(){this.Settings.AlertLogging&&alert("Button clicked!"),this.Settings.IsLocalEvent?this.entity.fire(this.Settings.FireEvent):this.app.fire(this.Settings.FireEvent)}),this)};var ToggleEntities=pc.createScript("toggleEntities");ToggleEntities.attributes.add("enabledEntity",{type:"entity",title:"Enabled Entity"}),ToggleEntities.attributes.add("disabledEntity",{type:"entity",title:"Disabled Entity"}),ToggleEntities.prototype.initialize=function(){this.enabledEntity&&(this.enabledEntity.enabled=!1),this.disabledEntity&&(this.disabledEntity.enabled=!1)},ToggleEntities.prototype.toggleEntities=function(t){this.enabledEntity&&(this.enabledEntity.enabled=t),this.disabledEntity&&(this.disabledEntity.enabled=!t)};var RadarManager=pc.createScript("radarManager");RadarManager.attributes.add("Entities",{type:"json",schema:[{name:"radarPivot",title:"Radar Pivot",type:"entity"},{name:"radarScreen",title:"Radar Screen",type:"entity"},{name:"radarHolder",title:"Radar Holder",type:"entity"},{name:"directionDebug",title:"Direction Debug",type:"entity"},{name:"radarImages",title:"Radar Images",type:"entity",array:!0}]}),RadarManager.attributes.add("Settings",{type:"json",schema:[{name:"radarSpeed",title:"Radar Speed",type:"number",default:70},{name:"updateInterval",title:"Update Interval",type:"number",default:.5},{name:"radarRadius",title:"Radar Radius",type:"number",default:500},{name:"difficulty",title:"Difficulty",type:"number",default:1,enum:[{Easy:1},{Medium:2},{Hard:3}]},{name:"distanceThreshold",title:"Distance Threshold",type:"number",default:10}]}),RadarManager.prototype.degToRad=function(t){return t*Math.PI/180},RadarManager.prototype.radToDeg=function(t){return 180*t/Math.PI},RadarManager.prototype.initialize=function(){this.app.on("radarScreen:enable",this.setupRadar,this),this.app.on("radarScreen:reset",this.resetRadar,this),this.app.fire("radar:fadeIn"),this.initializeSensors(),this.timeSinceLastUpdate=0,this.initializeImageOpacities(),this.setDifficultyParameters(),this.isCreatureFound=!1,this.isRadarActive=!1,this.totalDistanceMoved=0},RadarManager.prototype.setupRadar=function(){this.Entities.radarScreen.enabled=!0,this.app.fire("radar:fadeIn"),this.app.fire("radar:fadeIn:foreground"),this.app.fire("radar:fadeIn:needle");var t=this.Settings.radarRadius,e=this.degToRad(pc.math.random(60,120)),a=t*Math.cos(e),i=t*Math.sin(e);this.Entities.radarHolder.setLocalPosition(a,i,0),this.initialHeading=this.heading,this.isRadarActive=!0,this.app.fire("radar:sweep"),this.app.fire("captureIndicator:reset")},RadarManager.prototype.creatureFound=function(){this.isCreatureFound=!0,this.isRadarActive=!1,this.app.fire("captureIndicator:setRadarFoundHolder"),this.app.fire("radarScreen:Found"),this.app.fire("radar:fadeOut"),this.app.fire("radar:fadeOut:foreground"),this.app.fire("radar:fadeOut:needle"),setTimeout((()=>{this.app.fire("captureIndicator:fadeIn",this.fadeDuration,!1)}),500)},RadarManager.prototype.update=function(t){if(!this.isCreatureFound&&this.isRadarActive){var e=-1*this.Settings.radarSpeed*t,a=this.Entities.radarPivot.getLocalEulerAngles();a.z+=e,this.Entities.radarPivot.setLocalEulerAngles(a),this.timeSinceLastUpdate+=t,this.timeSinceLastUpdate>=this.Settings.updateInterval&&(this.updateRadarHolderPosition(),this.timeSinceLastUpdate=0),this.checkRadarHolderFacing()}},RadarManager.prototype.checkRadarHolderFacing=function(){var t=this.Entities.radarPivot.getLocalPosition(),e=this.Entities.radarHolder.getLocalPosition().clone().sub(t),a=Math.atan2(e.y,e.x),i=this.Entities.radarPivot.getLocalEulerAngles().z,r=this.degToRad(i);Math.abs(r-a)<this.degToRad(5)&&this.triggerFadeInOut()},RadarManager.prototype.triggerFadeInOut=function(){this.app.fire("captureIndicator:fadeIn",.2,!0),this.app.fire("radar:ping"),setTimeout((()=>{this.app.fire("radar:sweep")}),1e3)},RadarManager.prototype.initializeSensors=function(){window.DeviceMotionEvent?window.addEventListener("devicemotion",this.handleMotion.bind(this),!0):console.log("DeviceMotionEvent is not supported on this device."),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",this.handleOrientation.bind(this),!0):console.log("DeviceOrientationEvent is not supported on this device.")},RadarManager.prototype.handleMotion=function(t){var e=t.accelerationIncludingGravity,a=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);this.stepDetected=a>12,this.stepDetected&&(this.totalDistanceMoved+=1.5*a,this.updateWalkingDirection())},RadarManager.prototype.handleOrientation=function(t){this.heading=t.alpha},RadarManager.prototype.updateWalkingDirection=function(){this.heading;this.Entities.directionDebug.element.text="Heading: "+this.Entities.radarHolder.getLocalPosition().y},RadarManager.prototype.updateRadarHolderPosition=function(){var t=this.Settings.radarRadius,e=this.totalDistanceMoved/this.Settings.difficulty,a=Math.max(t-e,0),i=this.Entities.radarHolder.getLocalPosition().x,r=a;a<this.Settings.distanceThreshold?this.creatureFound():this.Entities.radarHolder.setLocalPosition(i,r,0)},RadarManager.prototype.initializeImageOpacities=function(){this.imageElements=this.Entities.radarImages.map((function(t){return t.element}))},RadarManager.prototype.updateImageOpacities=function(){for(var t=this.Entities.radarPivot.getLocalEulerAngles().z*Math.PI/180,e=!1,a=0;a<this.imageElements.length;a++){var i=2*a*Math.PI/this.imageElements.length;if(Math.abs(t-i)<this.sweepThreshold){e=!0;break}}e&&this.isRadarActive&&(this.app.fire("captureIndicator:fadeIn",this.fadeDuration,!0),setTimeout((()=>{this.app.fire("radar:sweep")}),500),this.app.fire("radar:ping"))},RadarManager.prototype.setDifficultyParameters=function(){switch(this.Settings.difficulty){case 1:this.Settings.radarSpeed=180,this.sweepThreshold=.2,this.fadeDuration=.5,this.difficultyLerpFactor=.1;break;case 2:default:this.Settings.radarSpeed=50,this.sweepThreshold=.1,this.fadeDuration=.1,this.difficultyLerpFactor=.05;break;case 3:this.Settings.radarSpeed=30,this.sweepThreshold=.05,this.fadeDuration=.05,this.difficultyLerpFactor=.02}},RadarManager.prototype.resetRadar=function(){this.isCreatureFound=!1,this.isRadarActive=!1,this.timeSinceLastUpdate=0,this.totalDistanceMoved=0,this.Entities.radarPivot.setLocalEulerAngles(0,0,0),this.Entities.radarScreen.enabled=!1,this.setDifficultyParameters();var t=this.Settings.radarRadius,e=this.degToRad(pc.math.random(60,120)),a=t*Math.cos(e),i=t*Math.sin(e);this.Entities.radarHolder.setLocalPosition(a,i,0),console.log("Radar holder reset to position:",a,i);for(var r=0;r<this.imageElements.length;r++)this.imageElements[r].opacity=0;this.Entities.directionDebug.element.text="Heading: 0"};var UITween=pc.createScript("uiTween");UITween.attributes.add("targetPosition",{type:"vec3",default:[0,0,0],title:"Target Position"}),UITween.attributes.add("tweenDuration",{type:"number",default:1,title:"Tween Duration"}),UITween.attributes.add("tweenType",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear",title:"Tween Type"}),UITween.attributes.add("triggerEvent",{type:"string",title:"Trigger Event"}),UITween.attributes.add("resetEvent",{type:"string",title:"Reset Event"}),UITween.prototype.initialize=function(){this.initialPosition=this.entity.getLocalPosition().clone(),this.app.on(this.triggerEvent,this.startTween,this),this.app.on(this.resetEvent,this.resetPosition,this)},UITween.prototype.onDestroy=function(){this.app.off(this.triggerEvent,this.startTween,this),this.app.off(this.resetEvent,this.resetPosition,this)},UITween.prototype.startTween=function(){var t=this.entity.getLocalPosition();this.entity.tween(t).to(this.targetPosition,this.tweenDuration,pc[this.tweenType]).start()},UITween.prototype.resetPosition=function(){this.entity.setLocalPosition(this.initialPosition)};var CaptureIndicator=pc.createScript("captureIndicator");CaptureIndicator.attributes.add("Entities",{type:"json",schema:[{name:"captureIndicator",title:"Capture Indicator",type:"entity"},{name:"captureIndicatorFill",title:"Capture Indicator Fill",type:"entity"},{name:"radarHolder",title:"Radar Holder",type:"entity"},{name:"creatureHealthbarIcon",title:"Creature Health Bar Icon",type:"entity",array:!0},{name:"creatureCapturedIcon",title:"Creature Captured Icon",type:"entity",array:!0},{name:"Screen",title:"2D Screen",type:"entity"},{name:"RadarFoundHolder",title:"Radar Found Holder",type:"entity"},{name:"CaughtCross",title:"Caught Cross",type:"entity"}]}),CaptureIndicator.attributes.add("Colors",{type:"json",schema:[{name:"captureIconColor",title:"Capture Icon Color",type:"rgb",default:[1,0,0]}],array:!0}),CaptureIndicator.prototype.initialize=function(){this.app.on("captureIndicator:setup",this.setupCreatureIndicator,this),this.app.on("captureIndicator:setScreenParent",this.setScreenParent,this),this.app.on("captureIndicator:setRadarFoundHolder",this.setRadarFoundHolder,this),this.app.on("captureIndicator:fadeIn",this.fadeInAll,this),this.app.on("captureIndicator:enableCapturedIcon",this.enableCreatureCapturedIcon,this),this.app.on("captureIndicator:reset",this.resetOpacities,this),this.isCreatureFound=!1,this.currentCreatureHealthbarIcon=null,this.tweens=new Map,this.states=new Map,this.initializeImageOpacities()},CaptureIndicator.prototype.initializeImageOpacities=function(){this.imageEntities=[this.Entities.captureIndicator,this.Entities.captureIndicatorFill,...this.Entities.creatureHealthbarIcon];for(var t=0;t<this.imageEntities.length;t++)this.states.set(this.imageEntities[t],{fadingIn:!1,fadingOut:!1})},CaptureIndicator.prototype.setScreenParent=function(){var t=this.Entities.captureIndicator.getPosition().clone();this.Entities.Screen.addChild(this.Entities.captureIndicator),this.Entities.captureIndicator.setLocalScale(1.1,1.1,1.1),this.Entities.captureIndicator.setPosition(t)},CaptureIndicator.prototype.setRadarFoundHolder=function(){this.Entities.RadarFoundHolder.addChild(this.Entities.captureIndicator)},CaptureIndicator.prototype.setupCreatureIndicator=function(t){if(t<0||t>=this.Colors.length)console.error("Index out of range");else{var e=this.Colors[t].captureIconColor;this.Entities.captureIndicatorFill.element.color=e;for(var i=0;i<this.Entities.creatureCapturedIcon.length;i++)this.Entities.creatureCapturedIcon[i].enabled=!1;this.Entities.CaughtCross.enabled=!1;for(i=0;i<this.Entities.creatureHealthbarIcon.length;i++)i===t?(this.Entities.creatureHealthbarIcon[i].enabled=!0,this.currentCreatureHealthbarIcon=this.Entities.creatureHealthbarIcon[i]):this.Entities.creatureHealthbarIcon[i].enabled=!1;this.Entities.radarHolder.addChild(this.Entities.captureIndicator),this.Entities.captureIndicator.setLocalPosition(0,0,0),this.Entities.captureIndicator.setLocalScale(.3,.3,.3),this.Entities.captureIndicator.enabled=!0}},CaptureIndicator.prototype.enableCreatureCapturedIcon=function(t){if(t<0||t>=this.Entities.creatureCapturedIcon.length)console.error("Index out of range");else{for(var e=0;e<this.Entities.creatureHealthbarIcon.length;e++)this.Entities.creatureHealthbarIcon[e].enabled=!1;for(e=0;e<this.Entities.creatureCapturedIcon.length;e++)this.Entities.creatureCapturedIcon[e].enabled=e===t;this.Entities.CaughtCross.enabled=!0}},CaptureIndicator.prototype.fadeInAll=function(t,e){for(var i=0;i<this.imageEntities.length;i++){var a=this.imageEntities[i];this.fadeIn(a,t,e)}},CaptureIndicator.prototype.fadeOutAll=function(t){for(var e=0;e<this.imageEntities.length;e++){var i=this.imageEntities[e];this.fadeOut(i,t)}},CaptureIndicator.prototype.fadeIn=function(t,e,i){var a=this.states.get(t);a.fadingOut&&(this.tweens.has(t)&&this.tweens.get(t).stop(),a.fadingOut=!1),a.fadingIn=!0;var r=t.tween(t.element).to({opacity:1},e,pc.Linear).onComplete((()=>{a.fadingIn=!1,this.states.set(t,a),i&&this.fadeOut(t,e)})).start();this.tweens.set(t,r),this.states.set(t,a)},CaptureIndicator.prototype.fadeOut=function(t,e){var i=this.states.get(t);i.fadingIn&&(this.tweens.has(t)&&this.tweens.get(t).stop(),i.fadingIn=!1),i.fadingOut=!0;var a=t.tween(t.element).to({opacity:0},e,pc.Linear).onComplete((()=>{i.fadingOut=!1,this.states.set(t,i)})).start();this.tweens.set(t,a),this.states.set(t,i)},CaptureIndicator.prototype.resetOpacities=function(){for(var t=0;t<this.imageEntities.length;t++){var e=this.imageEntities[t];e.element.opacity=1;var i=this.states.get(e);i.fadingIn=!1,i.fadingOut=!1,this.states.set(e,i)}};var UIScaleTween=pc.createScript("uiScaleTween");UIScaleTween.attributes.add("targetEntity",{type:"entity",title:"Target Entity"}),UIScaleTween.attributes.add("enableStartPosition",{type:"boolean",default:!1,title:"Enable Start Position"}),UIScaleTween.attributes.add("startPosition",{type:"vec3",default:[0,0,0],title:"Start Position"}),UIScaleTween.attributes.add("targetPosition",{type:"vec3",default:[0,0,0],title:"Target Position"}),UIScaleTween.attributes.add("targetScale",{type:"vec3",default:[1,1,1],title:"Target Scale"}),UIScaleTween.attributes.add("tweenDuration",{type:"number",default:1,title:"Tween Duration"}),UIScaleTween.attributes.add("tweenDelay",{type:"number",default:0,title:"Tween Delay"}),UIScaleTween.attributes.add("tweenType",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear",title:"Tween Type"}),UIScaleTween.attributes.add("triggerEvent",{type:"string",title:"Trigger Event"}),UIScaleTween.prototype.initialize=function(){this.app.on(this.triggerEvent,this.startTween,this)},UIScaleTween.prototype.onDestroy=function(){this.app.off(this.triggerEvent,this.startTween,this)},UIScaleTween.prototype.startTween=function(){var t=this.targetEntity||this.entity,e=this.enableStartPosition?this.startPosition:t.getLocalPosition(),n=t.getLocalScale();this.enableStartPosition&&t.setLocalPosition(this.startPosition),t.tween(e).to(this.targetPosition,this.tweenDuration,pc[this.tweenType]).delay(this.tweenDelay).start(),t.tween(n).to(this.targetScale,this.tweenDuration,pc[this.tweenType]).delay(this.tweenDelay).start()};var CreatureManager=pc.createScript("creatureManager");CreatureManager.attributes.add("entities",{type:"json",schema:[{name:"CreaturePlayers",title:"Creature Players",type:"entity",array:!0},{name:"knightlingParticleEffect",title:"Knightling Particle Effect",type:"entity"}]}),CreatureManager.prototype.initialize=function(){this.currentCreatureIndex=-1,this.app.on("creatureManager:setupCreature",this.setupCreature,this),this.app.on("creatureManager:disableCurrentCreature",this.disableCurrentCreature,this)},CreatureManager.prototype.setupCreature=function(e){for(var t=0;t<this.entities.CreaturePlayers.length;t++)this.entities.CreaturePlayers[t].enabled=t===e;this.currentCreatureIndex=e,0==e&&this.entities.knightlingParticleEffect.script.effekseerEmitter.play()},CreatureManager.prototype.disableCurrentCreature=function(e){if(-1!==this.currentCreatureIndex){0==this.currentCreatureIndex&&this.entities.knightlingParticleEffect.script.effekseerEmitter.stop();var t=this.entities.CreaturePlayers[this.currentCreatureIndex].getPosition();e&&this.app.fire("chararacter:destroy",t),this.entities.CreaturePlayers[this.currentCreatureIndex].enabled=!1,this.currentCreatureIndex=-1}};var Ui=pc.createScript("ui");Ui.prototype.initialize=function(){},Ui.prototype.update=function(i){};var SoundOnEvent=pc.createScript("soundOnEvent");SoundOnEvent.attributes.add("eventName",{type:"string",default:"yourEventName",title:"Event Name"}),SoundOnEvent.attributes.add("soundSlotName",{type:"string",default:"yourSoundSlot",title:"Sound Slot Name"}),SoundOnEvent.attributes.add("minPitch",{type:"number",default:.5,title:"Min Pitch"}),SoundOnEvent.attributes.add("maxPitch",{type:"number",default:1.5,title:"Max Pitch"}),SoundOnEvent.prototype.initialize=function(){var t=this;this.app.on(this.eventName,(function(){t.playSound()}),this)},SoundOnEvent.prototype.playSound=function(){if(this.entity.sound&&this.entity.sound.slots[this.soundSlotName]){var t=pc.math.lerp(this.minPitch,this.maxPitch,Math.random()),n=this.entity.sound.slot(this.soundSlotName);n.pitch=t,n.play()}else console.warn('Sound Slot "'+this.soundSlotName+'" not found on entity or AudioSource component missing.')},SoundOnEvent.prototype.destroy=function(){this.app.off(this.eventName,this.playSound,this)};var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("video",{title:"Video",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.attributes.add("endEvent",{title:"End Event",description:"Event that is fired when the video finishes playing.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!1;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!1}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this)),t.addEventListener("ended",function(t){e.fire(this.endEvent,this.videoTexture)}.bind(this)),t.src=this.video?this.video.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load()},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};var ApplyUiVideoZapparAlphaMask=pc.createScript("applyUiVideoZapparAlphaMask");ApplyUiVideoZapparAlphaMask.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),ApplyUiVideoZapparAlphaMask.prototype.initialize=function(){this.app.on(this.playEvent,(a=>{const e=this.entity.render.material.clone();e.emissive.set(1,1,1),e.opacity=1,e.emissiveMap=a,e.emissiveMapOffset=new pc.Vec2(0,0),e.emissiveMapTiling=new pc.Vec2(.5,1),e.opacityMap=a,e.opacityMapChannel="r",e.opacityMapOffset=new pc.Vec2(.5,0),e.opacityMapTiling=new pc.Vec2(.5,1),e.alphaTest=.9,e.update(),this.entity.render.material=e,this._material=e})),this.on("destroy",(()=>{this._material&&(this._material.destroy(),this._material=null)}))};var Shot=pc.createScript("shot");Shot.attributes.add("eventName",{type:"string",default:"fireEffect",title:"Event Name"}),Shot.prototype.initialize=function(){this.app.on(this.eventName,this.fireEffect,this)},Shot.prototype.fireEffect=function(t){t&&this.entity.setPosition(t),this.entity.script.effekseerEmitter.play()},Shot.prototype.destroy=function(){this.app.off(this.eventName,this.fireEffect,this)};var EffekseerEmitter=pc.createScript("effekseerEmitter");EffekseerEmitter.attributes.add("effect",{type:"asset",assetType:"binary"}),EffekseerEmitter.attributes.add("playOnEnter",{type:"boolean"}),EffekseerEmitter.attributes.add("scale",{type:"number",default:1}),EffekseerEmitter.prototype.initialize=function(){if(window.createPlayCanvasEffekseerSystem(this.app),this.effect){theApp=this.app;var e=function redirect(e){var t=e.split("/"),s=t[t.length-1],f=theApp.assets.findAll(s);if(0===f.length)return e;for(var i=0;i<f.length;i+=1){return f[i].getFileUrl()}return e};console.log(this.effect),console.log(this.effect.getFileUrl()),window.playCanvasEffekseerSystem.context.addEvent((t=>{this.effekseer_effect=t.context.loadEffect(this.effect.getFileUrl(),this.scale,(()=>{}),(()=>{}),e)}))}this.on("destroy",(function(){if(this.effekseer_effect.isLoaded){window.playCanvasEffekseerSystem.context.context.releaseEffect(this.effekseer_effect);this.effekseer_effect=null}window.deletePlayCanvasEffekseerSystem()})),this._handles=[],this._commands=[],this.playOnEnter&&this.play()},EffekseerEmitter.prototype.update=function(e){this.effekseer_effect&&this.effekseer_effect.isLoaded&&(this._commands.forEach((function(e){e()})),this._commands=[]),this._handles=this._handles.filter((function(e){return e.exists}));for(var t=0;t<this._handles.length;t++){var s=this.entity.getWorldTransform();this._handles[t].setMatrix(Array.prototype.slice.call(s.data))}},EffekseerEmitter.prototype.play=function(){var e=function(){var e=window.playCanvasEffekseerSystem.context.context.play(this.effekseer_effect,0,0,0),t=this.entity.getWorldTransform();e.setMatrix(Array.prototype.slice.call(t.data)),this._handles.push(e)}.bind(this);this.effekseer_effect&&this.effekseer_effect.isLoaded?e():this._commands.push(e)},EffekseerEmitter.prototype.stop=function(){var e=function(){this._handles.length>0&&this._handles.pop().stop()}.bind(this);this.effekseer_effect&&this.effekseer_effect.isLoaded?e():this._commands.push(e)};function addEffekseerWasmLoadingEvent(e){effekseerWasmLoaded?e():effekseerWasmLoadingEvents.push(e)}void 0===pc.Application.getApplication()?effekseerWasmAssets=[]:effekseerWasmAssets=pc.Application.getApplication().assets.findAll("effekseer_native.wasm"),effekseerWasmLoadingEvents=[],effekseerWasmLoaded=!1,effekseerWasmAssets.length>0&&(effekseer.setImageCrossOrigin("anonymous"),pc.WasmModule.getInstance("effekseer_native",(e=>{window.effekseer_native=e})),effekseer.initRuntime(effekseerWasmAssets[0].getFileUrl(),(()=>{pc.Application.getApplication().graphicsDevice.gl;effekseerWasmLoaded=!0;for(var e=0;e<effekseerWasmLoadingEvents.length;e++)effekseerWasmLoadingEvents[e]()})));class EffekseerContext{constructor(e){this.context=null,this.loaded=!1,this._events=[],addEffekseerWasmLoadingEvent((()=>{this.context=effekseer.createContext(),this.context.init(e.graphicsDevice.gl,{enableExtensionsByDefault:!1}),this.loaded=!0;for(var s=0;s<this._events.length;s++)this._events[s](this)}))}release(){addEffekseerWasmLoadingEvent((()=>{effekseer.releaseContext(this.context)}))}addEvent(e){this.loaded?e(this):this._events.push(e)}}class PlayCanvasEffekseerSystem{constructor(e){this.context=new EffekseerContext(e)}release(){this.context.release()}}window.playCanvasEffekseerSystem=null,window.playCanvasEffekseerSystemCount=0,window.createPlayCanvasEffekseerSystem=function(e){0===window.playCanvasEffekseerSystemCount&&(window.playCanvasEffekseerSystem=new PlayCanvasEffekseerSystem(e)),window.playCanvasEffekseerSystemCount+=1},window.deletePlayCanvasEffekseerSystem=function(){window.playCanvasEffekseerSystemCount-=1,0===window.playCanvasEffekseerSystemCount&&(window.playCanvasEffekseerSystem=null)};var EffekseerSystem=pc.createScript("effekseerSystem");EffekseerSystem.attributes.add("Camera",{type:"entity"}),EffekseerSystem.prototype.initialize=function(){window.createPlayCanvasEffekseerSystem(this.app);var e=new pc.Layer({name:"effekseerlayer",onPostRenderTransparent:function(e){window.playCanvasEffekseerSystem.context.loaded&&window.playCanvasEffekseerSystem.context.context.draw()}});this.layer=e;var s=this.app.scene.layers.getLayerByName("World"),t=this.app.scene.layers.getTransparentIndex(s);this.app.scene.layers.insertTransparent(e,t+1);var a=this.Camera.camera,n=a.layers.concat();n.push(e.id),a.layers=n,this.on("destroy",(function(){window.deletePlayCanvasEffekseerSystem()})),this._restTime=0},EffekseerSystem.prototype.update=function(e){var s=window.playCanvasEffekseerSystem.context;if(s.loaded){var t=this.Camera.camera;for(this._restTime+=e;this._restTime>=1/60;)s.context.update(1),this._restTime-=1/60;s.context.setProjectionMatrix(t.projectionMatrix.data),s.context.setCameraMatrix(t.viewMatrix.data)}};